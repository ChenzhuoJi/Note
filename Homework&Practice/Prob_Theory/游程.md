## 游程

假设有一段成功率为$p$的序列，求连续$n$次的成功在连续$m$次失败之前的概率。

**Soulution:** 设以下事件的记号：$E=\left\{ \text{连续n次成功在连续m次失败之前} \right\} $, $F=\left\{ \text{第2到n次都成功} \right\} $, $H_1=\left\{ \text{第1次成功 }\right\} $

这里我们可以知道：$P(F)=p^{n-1}, P(E)=p$

$$
P(E)=P(E|H_1)P(H)+P(E|H_1^c)(H^c) \tag{1}
$$
$$
P(E|H_1)=P(E|H_1F)P(F)+P(E|H_1F^c)P(F^c) \tag{2}
$$

(2)式中$P(E|HF)=1$，我们只需考虑$P(E|HF^c)$，事实上：

$$
P(E|HF^c)=P(E|H^c)
$$

事件$HF^c$意味着前$k(k<n)$次是连续成功的，而第$k+1$次是失败的，我们要考虑n次成功在m次连续失败之前的事件，因为第$k+1$次实验是失败的，所以前k次成功对$E$的影响是没有的，无论k等于多少，也要从第$k+1$次重新计算连续成功的次数，和实验只做了1次但失败了是一个效果。或者用数学的记号来说明：

$$
H_i=\left\{ 第i次实验是成功的 \right\} 
$$

$$
H_1F^c=(H_1H_2^c)\cup(H_1H_2H_3^c)\cup \cdots \cup(H_1H_2H_3\cdots H_{n-1}H_n^c)
$$

$$
P(E|H_1^c)=P(E|HF^c)
$$

设$x=P(E|H_1),y=P(E|H_1^c), q=1-p$

$$
x=P(E|H_1F)P(F)+P(E|H^c)P(F^c)=p^{n-1}+y(1-p^{n-1}) \tag{3}
$$

---

考虑到 $y=P(E|H_1^c)=1-P(E^c|H_1^c)$, $E^c=\left\{ n次连续成功在m次连续失败之后 \right\} $

用上面同样的思想，设$G=\left\{ 第2到m次全部失败 \right\} $

$$
P(E^c|H_1^c)=P(E^c|H_1^cG)P(G)+P(E^c|H_1^cG^c)P(G^c) 
$$

$$
P(E^c|H_1^cG^c)=P(E^c|H)=1-P(E|H_1) 
$$

上面的式子讨论可以化为一个方程：
$$
1-y=q^{m-1}+(1-x)(1-q^{m-1}) \tag{4}
$$

即有方程组：
$$
\begin{cases} x=p^{n-1}+y(1-p^{n-1})  \\ 1-y=q^{m-1}+(1-x)(1-q^{m-1}) \\ p+q=1  \end{cases}
$$

可以解得：
$$
x=\frac{p^{n-1}}{p^{n-1}+q^{m-1}-p^{n-1}q^{m-1}},y=\frac{(1-q^{m-1})p^{n-1}}{p^{n-1}+q^{m-1}-p^{n-1}q^{m-1}}
$$

最后：
$$
\begin{aligned}
P(E) & = px+qy =\frac{p^n+(1-p)p^{n-1}(1-q^{m-1})}{p^{n-1}+q^{m-1}-p^{n-1}q^{m-1}} \\
& = \frac{p^{n-1}(1-q^{m-1})}{p^{n-1}+q^{m-1}-p^{n-1}q^{m-1}}  \\
\end{aligned}
$$
